<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../polymerfire/polymerfire.html">
<link rel="import" href="../app-layout/app-layout.html">

<link rel="import" href="plutonium-elements.html">

<dom-module id="plutonium-app">
    <template>
        <style include="plutonium-shared-styles">
        </style>

        <firebase-auth
            id="auth"
            app-name="notes"
            provider="google"
            signed-in="{{signedIn}}"
            user="{{user}}">
        </firebase-auth>

        <app-scrollpos-control selected="{{page}}"></app-scrollpos-control>

        <app-drawer-layout>

            <app-drawer>
                <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
                    <content select=".menu"></content>
                </iron-selector>
            </app-drawer>

            <app-header-layout>
                <app-header>
                    <app-toolbar>
                        <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                        <plutonium-toolbar 
                            main-title
                            user="[[user]]"
                            app-name="Test title"
                            signed-in="[[signedIn]]"
                            on-sign-out="signOut">
                        </plutonium-toolbar>
                    </app-toolbar>
                </app-header>

                <iron-pages role="main" selected="[[page]]" attr-for-selected="name">
                    <content select=".page"></content>
                    <sample-content size="100"></sample-content>
                    <sample-content size="100"></sample-content>
                    <sample-content size="100"></sample-content>
                    <sample-content size="100"></sample-content>
                </iron-pages>

            </app-header-layout>

        </app-drawer-layout>



        <plutonium-login-page
            on-sign-in="signIn"
            signed-in="[[signedIn]]"
            disabled="[[!online]]">
        </plutonium-login-page>

        <content></content>
    </template>
    <script>
        /**
         * `<plutonium-app>` is a login screen with the choosable login methods.
         *
         * In typical use, just route to the anonymous users with `<plutonium-app>`:
         * 
         *     <body>
         *       <plutonium-app></plutonium-app>
         *     </body>
         * 
         *  @hero path/to/image
         *  @demo demo/index.html  Secure application demo!
         *  @demo demo/index.html  CRUD operations on firebase demo!
         */

        Polymer({
            is: 'plutonium-app',
            behaviors: [
                Plutonium.AppBehavior,
                Plutonium.CrudBehavior
            ],
            properties: {
                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                }
            },
            observers: [
                '_routePageChanged(routeData.page)'
            ],
            _routePageChanged: function (page) {
                this.page = page || 'view1';
            },
            _pageChanged: function (page) {
                // load page import on demand.
                this.importHref(
                        this.resolveUrl('my-' + page + '.html'), null, null, true);
            }
            /**
             * Fired when user log in.
             *
             * @event sign-in
             */

        });
    </script>
</dom-module>